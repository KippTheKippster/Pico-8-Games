pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
local rot = 0
local x = 52
local y = 64

local function fwall(px,py, r1, t)
	--spr(2, px, py)
	dx = px - x
	dy = py - y
	
	dr = r1
	dr = mid(-0.4,dr,0.4)

	
	r = cos(r1)*82
	dis = ((dx^2 + dy^2)^0.5)
	*sin(dr)
	l = (64/dis)*12
 --r = (-r+0.5)*64
	
	
--	rectfill(64+r-5, 64 + l,
	--64+r+5, 64 - l, t)
		line(64+r, 64 + l,
	64+r, 64 - l, t)
end

local function _update60()
	--walk
	if(btn(2)) then --back
		x = x + cos(rot)
		y = y + sin(rot)
	end
	if(btn(3)) then --forward
		x = x - cos(rot)
		y = y - sin(rot)
	end
	if(btn(0)) then --right
		rot = rot + 0.005
	end
	if(btn(1)) then --left
		rot = rot - 0.005
	end

	--cast
	cls(1)
	--map(0,0,0,0,32,32)
	for i = 0, 200 do
		q = i / 400
			for z = 1, 16 do
				_x = flr(x/8 + cos(q + rot - 0.25) * z)
				_y = flr(y/8 + sin(q + rot - 0.25) * z)
				
				local t = mget(_x, _y)
				
				if(t ~= 0) then
					fwall(_x*8,_y*8, q, t)
					break
				end
			end
	end	
	--spr(1, x, y)
	--spr(4, x + 6 * cos(rot),y+6*sin(rot))
end
__gfx__
00000000ccccccccddddddddeeeeeeee00000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cc0cc0ccddddddddeeeeeeee00088000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ccccccccd88888ddeeeeeeee00088000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000ccccc0cd88888ddeeeeeeee08888880ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000cccc0ccd88888ddeeeeeeee08888880ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700c00c00ccd88888ddeeeeeeee00088000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cc000cccddddddddeeeeeeee00088000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ccccccccddddddddeeeeeeee00000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0505050505050505050505050505050505050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000003030000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000003030000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000303000000000505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000303000000000500000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000500000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000500000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000500000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505000000000000000505050500000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000005000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000005000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000005000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000005000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000005000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000005050505050505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
